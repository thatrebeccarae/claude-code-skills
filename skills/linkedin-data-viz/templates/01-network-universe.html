<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Network Universe â€” LinkedIn Data Visualization</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<script src="https://d3js.org/d3.v7.min.js"></script>
<style>
{{THEME_CSS}}
</style>
</head>
<body>
<div class="container" style="padding:40px;">
<h1 style="font-size:2.2rem;margin-bottom:8px;">Network Universe</h1>
<p class="section-subtitle" id="subtitle"></p>

<div class="stats-row" id="stats"></div>

<div class="card" id="graph-container" style="position:relative;overflow:hidden;">
  <div id="graph" style="width:100%;height:700px;"></div>
  <div class="graph-tooltip" id="tooltip"></div>
  <div class="graph-legend" id="legend"></div>
</div>
</div>

<script>
const DATA = {{DATA}};
const PALETTE = ['#4eadab','#39FF14','#6bc0be','#A855F7','#FF5F1F','#FFD700','#8b949e','#4a9f9d','#7d8590','#FF2D55','#5ab8b6','#7dcbc9','#8ed6d4','#9fe1df','#b0ecea','#c1f7f5','#fdfdfe'];

document.getElementById('subtitle').textContent = DATA.subtitle || '';
const statsEl = document.getElementById('stats');
if (DATA.stats) statsEl.innerHTML = DATA.stats.map(s => `<div class="stat"><div class="stat-value">${s.value}</div><div class="stat-label">${s.label}</div></div>`).join('');

const gc = document.getElementById('graph');
const w = gc.clientWidth, h = 700;
const svg = d3.select('#graph').append('svg').attr('viewBox', `0 0 ${w} ${h}`).attr('preserveAspectRatio', 'xMidYMid meet');
const scale = d3.scaleSqrt().domain([0, d3.max(DATA.nodes, d => d.size)]).range([12, 65]);
const sim = d3.forceSimulation(DATA.nodes)
  .force('link', d3.forceLink(DATA.links).id(d => d.id).distance(d => 160 - d.strength * 3))
  .force('charge', d3.forceManyBody().strength(-500))
  .force('center', d3.forceCenter(w / 2, h / 2))
  .force('collision', d3.forceCollide().radius(d => scale(d.size) + 15));

const link = svg.append('g').selectAll('line').data(DATA.links).join('line')
  .attr('class', 'graph-link').attr('stroke-width', d => Math.max(1, d.strength * 0.5));

const node = svg.append('g').selectAll('g').data(DATA.nodes).join('g')
  .call(d3.drag()
    .on('start', (e, d) => { if (!e.active) sim.alphaTarget(0.3).restart(); d.fx = d.x; d.fy = d.y; })
    .on('drag', (e, d) => { d.fx = e.x; d.fy = e.y; })
    .on('end', (e, d) => { if (!e.active) sim.alphaTarget(0); d.fx = null; d.fy = null; })
  );

node.append('circle').attr('r', d => scale(d.size))
  .attr('fill', d => PALETTE[d.group % PALETTE.length]).attr('fill-opacity', 0.8)
  .attr('stroke', d => PALETTE[d.group % PALETTE.length]).attr('stroke-width', 2).attr('stroke-opacity', 0.9);
node.append('text').attr('class', 'node-label').attr('text-anchor', 'middle').attr('dy', '-0.3em').text(d => d.id);
node.append('text').attr('class', 'node-count').attr('text-anchor', 'middle').attr('dy', '1em').text(d => d.size);

const tip = document.getElementById('tooltip');
node.on('mouseover', (e, d) => {
  tip.innerHTML = `<strong>${d.id}</strong><br>${d.size} connections<div class="companies">Top: ${d.top_companies.join(', ')}</div>`;
  tip.style.opacity = 1; tip.style.left = (e.offsetX + 15) + 'px'; tip.style.top = (e.offsetY - 10) + 'px';
}).on('mouseout', () => { tip.style.opacity = 0; });

sim.on('tick', () => {
  link.attr('x1', d => d.source.x).attr('y1', d => d.source.y).attr('x2', d => d.target.x).attr('y2', d => d.target.y);
  node.attr('transform', d => `translate(${d.x},${d.y})`);
});

const leg = document.getElementById('legend');
[...DATA.nodes].sort((a, b) => b.size - a.size).forEach(n => {
  leg.innerHTML += `<div class="legend-item"><div class="legend-dot" style="background:${PALETTE[n.group % PALETTE.length]}"></div>${n.id} (${n.size})</div>`;
});
</script>
</body>
</html>
